# yml-language-server: $schema=https://json.schemastore.org/taskfile
# https://taskfile.devversion:

version: "3"

vars:
  CLEAN_TARGETS: __pycache__ .pytest_cache .venv output .coverage coverage.xml node_modules
  CLONE_DIR: .tmp

tasks:
  clean:
    desc: Clean the project
    cmds:
      - rm -rf {{.CLEAN_TARGETS}}

  clone-docs:
    desc: Clone the docs
    vars:
      AZURE_DOCS_DIR: "{{.CLONE_DIR}}/azure-docs"
      WELL_ARCHITECTED_DIR: "{{.CLONE_DIR}}/well-architected"
    deps:
      - clean-docs
    cmds:
      - git clone --filter=blob:none --no-checkout -b main --depth 1 https://github.com/MicrosoftDocs/well-architected.git {{.WELL_ARCHITECTED_DIR}}
      - cd {{.WELL_ARCHITECTED_DIR}} && git sparse-checkout init --no-cone
      - cp .dotfiles/git/well-architected/sparse-checkout {{.WELL_ARCHITECTED_DIR}}/.git/info/sparse-checkout
      - cd {{.WELL_ARCHITECTED_DIR}} && git checkout

      - git clone --filter=blob:none --no-checkout -b main --depth 1 https://github.com/MicrosoftDocs/azure-docs.git {{.AZURE_DOCS_DIR}}
      - cd {{.AZURE_DOCS_DIR}} && git sparse-checkout init --no-cone
      - cp .dotfiles/git/azure-docs/sparse-checkout {{.AZURE_DOCS_DIR}}/.git/info/sparse-checkout
      - cd {{.AZURE_DOCS_DIR}} && git checkout

  clean-docs:
    desc: Clean the docs
    cmds:
      - rm -rf well-architected azure-docs
